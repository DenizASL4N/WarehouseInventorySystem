{% extends "base.html" %}

{% block title %}{{ title }} - Warehouse IMS{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">{{ title }}</h1>
    {% if cart %}
    <div class="btn-toolbar mb-2 mb-md-0">
        <a href="{{ url_for('cart.clear_cart') }}" class="btn btn-outline-danger me-2" onclick="return confirm('Are you sure you want to clear your entire cart?');">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cart-x-fill me-1" viewBox="0 0 16 16">
                <path d="M.5 1a.5.5 0 0 0 0 1h1.11l.401 1.607 1.498 7.985A.5.5 0 0 0 4 12h1a2 2 0 1 0 0 4 2 2 0 0 0 0-4h7a2 2 0 1 0 0 4 2 2 0 0 0 0-4h1a.5.5 0 0 0 .491-.408l1.5-8A.5.5 0 0 0 14.5 3H2.89l-.405-1.621A.5.5 0 0 0 2 1zM6 14a1 1 0 1 1-2 0 1 1 0 0 1 2 0m7 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m_XA_SOURCE_FILE_mark_lines_start_x_M-10.793 3.207L8.5 5.414 6.207 3.207a.5.5 0 0 0-.708.708L7.793 6.121 5.5 8.414a.5.5 0 0 0 .708.708L8.5 6.835l2.293 2.293a.5.5 0 0 0 .707-.708L9.207 6.121l2.293-2.293a.5.5 0 0 0-.707-.708z"/>
            </svg>
            Clear Cart
        </a>
        {# "Proceed to Checkout" butonu artÄ±k aktif #}
        <a href="{{ url_for('orders.create_order') }}" class="btn btn-success">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bag-check-fill me-1" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M10.5 3.5a2.5 2.5 0 0 0-5 0V4h5zm1 0V4H15v10a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V4h3.5v-.5a3.5 3.5 0 1 1 7 0m-.646 5.354a.5.5 0 0 0-.708-.708L7 10.293 5.854 9.146a.5.5 0 1 0-.708.708l1.5 1.5a.5.5 0 0 0 .708 0z"/>
            </svg>
            Proceed to Checkout
        </a>
    </div>
    {% endif %}
</div>

{% if cart %}
<div class="table-responsive">
    <table class="table table-hover">
        <thead>
            <tr>
                <th scope="col" style="width: 50%;">Product</th>
                <th scope="col" class="text-center">Price</th>
                <th scope="col" class="text-center" style="width: 150px;">Quantity</th>
                <th scope="col" class="text-end">Subtotal</th>
                <th scope="col" class="text-center" style="width: 100px;">Remove</th>
            </tr>
        </thead>
        <tbody>
            {% for item in cart %}
            <tr>
                <td>{{ item.name }}</td>
                <td class="text-center">${{ "%.2f"|format(item.price) }}</td>
                <td class="text-center">
                    <form action="{{ url_for('cart.update_cart_item', product_id=item.id) }}" method="POST" class="d-inline-flex align-items-center">
                        <input type="number" name="quantity" value="{{ item.quantity }}" min="0" class="form-control form-control-sm" style="width: 70px;" aria-label="Quantity for {{item.name}}">
                        <button type="submit" class="btn btn-sm btn-outline-secondary ms-1">Update</button>
                    </form>
                </td>
                <td class="text-end">${{ "%.2f"|format(item.subtotal) }}</td>
                <td class="text-center">
                    <form action="{{ url_for('cart.remove_from_cart', product_id=item.id) }}" method="POST">
                        <button type="submit" class="btn btn-sm btn-danger" title="Remove {{item.name}} from cart" onclick="return confirm('Are you sure you want to remove \'{{item.name}}\' from your cart?');">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle-fill" viewBox="0 0 16 16">
                                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293z"/>
                            </svg>
                        </button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                <td colspan="3" class="text-end fs-5"><strong>Total:</strong></td>
                <td class="text-end fs-5"><strong>${{ "%.2f"|format(total_cart_amount) }}</strong></td>
                <td></td>
            </tr>
            <tr>
                <td colspan="5" class="text-end">
                    <a href="{{ url_for('orders.create_order') }}" class="btn btn-lg btn-success mt-3">
                         <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bag-check-fill me-1" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M10.5 3.5a2.5 2.5 0 0 0-5 0V4h5zm1 0V4H15v10a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V4h3.5v-.5a3.5 3.5 0 1 1 7 0m-.646 5.354a.5.5 0 0 0-.708-.708L7 10.293 5.854 9.146a.5.5 0 1 0-.708.708l1.5 1.5a.5.5 0 0 0 .708 0z"/>
                        </svg>
                        Proceed to Checkout
                    </a>
                </td>
            </tr>
        </tfoot>
    </table>
</div>
{% else %}
<div class="alert alert-info mt-3" role="alert">
    Your cart is currently empty. <a href="{{ url_for('products.list_products') }}" class="alert-link">Start shopping!</a>
</div>
{% endif %}
{% endblock %}